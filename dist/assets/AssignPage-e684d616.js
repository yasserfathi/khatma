import{au as ie,p as E,k as v,a2 as ue,c as w,w as r,l as _,o as i,g as n,a as s,j as A,a7 as f,a8 as c,a6 as Q,av as de,d as L,f as O,aw as G,ax as N,a5 as p,ar as H,Q as M,aa as D,a9 as I,a1 as ce,aq as me}from"./index-fb423868.js";import{a as $,c as C,d as q,Q as pe}from"./format-1ba3b2e1.js";import{S as g,Q as J,a as ve}from"./sweetalert2.esm.all-a61fabd4.js";import{Q as fe}from"./QForm-ac163a32.js";import{Q as _e}from"./QPage-c4af3978.js";import{u as ge}from"./use-quasar-b2065ecf.js";import{_ as ye}from"./_plugin-vue_export-helper-c27b6911.js";import"./position-engine-c8cf3575.js";const he={class:"row items-center q-mb-lg"},be={class:"q-ml-md"},ke={key:0,class:"text-subtitle2 text-grey-7"},xe={key:0,class:"row justify-center q-py-xl"},we={key:1,class:"row q-col-gutter-lg"},Ce={class:"col-12 col-md-4"},Ae={class:"row items-center q-gutter-x-xs"},Qe={class:"col-12 col-md-8"},qe={class:"row items-center justify-between q-mb-md"},Pe={class:"text-h6 text-primary"},Ve={key:0,class:"text-caption text-grey"},Be={class:"parts-grid"},Se=["onClick"],$e={class:"part-number"},Re={class:"part-status"},ze={key:0,class:"text-caption ellipsis text-center"},Ue={key:2,class:"text-grey-5"},Fe={__name:"AssignPage",setup(Te){const K=ie();ge();const h=K.params.id,R=v(!0),z=v(!1),b=v(null),P=v([]),m=v([]),y=v(null),u=v([]),V=v([]),B=E(()=>{var a;return((a=b.value)==null?void 0:a.juz_count)||30}),U=E(()=>Math.ceil(B.value/30)),W=a=>{const e=(a-1)*30+1,l=Math.min(a*30,B.value);return Array.from({length:l-e+1},(t,o)=>e+o)},X=E(()=>Array.from({length:B.value},(e,l)=>l+1).filter(e=>!S(e))),S=a=>Array.isArray(m.value)?m.value.some(e=>d.value&&e.id===d.value?!1:e.parts&&Array.isArray(e.parts)&&e.parts.includes(a)):!1,Y=a=>{var l;if(!Array.isArray(m.value))return"";const e=m.value.find(t=>d.value&&t.id===d.value?!1:t.parts&&Array.isArray(t.parts)&&t.parts.includes(a));return e?((l=e.user)==null?void 0:l.name)||"Ù…Ø³ØªØ®Ø¯Ù…":""},k=a=>(a-1)%30+1,Z=a=>{if(S(a)){const e=m.value.find(l=>d.value&&l.id===d.value?!1:l.parts&&Array.isArray(l.parts)&&l.parts.includes(a));return e!=null&&e.read?"bg-teal text-white cursor-not-allowed":"bg-amber text-black cursor-not-allowed"}return u.value.includes(a)?"bg-amber text-black shadow-3":"bg-grey-2 text-grey-8 hover-effect"},ee=a=>{if(S(a))return;const e=u.value.indexOf(a);e===-1?u.value.push(a):u.value.splice(e,1)},te=async()=>{R.value=!0;try{const a=await _.get(`/api/khatmas/${h}`);b.value=a.data;const e=await _.get("/api/users"),l=String(b.value.group_id);P.value=e.data.filter(o=>!o.group_numbers||!Array.isArray(o.group_numbers)?!1:o.group_numbers.some(x=>String(x)===l)),V.value=P.value;const t=await _.get("/api/tilawa-khatma-assignments",{params:{khatma_id:h}});m.value=t.data}catch(a){console.error("Error loading data",a),g.fire({icon:"error",title:"Ø®Ø·Ø£",text:"ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"})}finally{R.value=!1,Array.isArray(m.value)||(m.value=[])}},ae=(a,e)=>{if(a===""){e(()=>{V.value=P.value});return}e(()=>{const l=a.toLowerCase();V.value=P.value.filter(t=>t.name.toLowerCase().indexOf(l)>-1)})},F=v(!1),d=v(null),se=async()=>{var a,e;if(!(!y.value||u.value.length===0)){z.value=!0;try{const l={khatma_id:h,user_id:y.value,parts:u.value,read:F.value};d.value?(await _.put(`/api/tilawa-khatma-assignments/${d.value}`,l),g.fire({icon:"success",title:"ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«",text:"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­",timer:1500,showConfirmButton:!1})):(await _.post("/api/tilawa-khatma-assignments",l),g.fire({icon:"success",title:"ØªÙ… Ø§Ù„Ø­ÙØ¸",text:"ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­",timer:1500,showConfirmButton:!1})),j();const t=await _.get("/api/tilawa-khatma-assignments",{params:{khatma_id:h}});m.value=t.data}catch(l){console.error("Error assigning",l);const t=((e=(a=l.response)==null?void 0:a.data)==null?void 0:e.message)||"ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„ØªØ¹ÙŠÙŠÙ†";g.fire({icon:"error",title:"Ø®Ø·Ø£",text:t})}finally{z.value=!1}}},le=a=>{d.value=a.id,y.value=a.user_id,u.value=a.parts||[],F.value=!!a.read},T=v(null),re=a=>{g.fire({title:"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù",text:"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ¹ÙŠÙŠÙ†ØŸ",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù",cancelButtonText:"Ø¥Ù„ØºØ§Ø¡"}).then(async e=>{if(e.isConfirmed)try{await _.delete(`/api/tilawa-khatma-assignments/${a.id}`),g.fire("ØªÙ… Ø§Ù„Ø­Ø°Ù","ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ¹ÙŠÙŠÙ†","success"),d.value===a.id&&j();const l=await _.get("/api/tilawa-khatma-assignments",{params:{khatma_id:h}});m.value=l.data}catch(l){console.error("Error deleting",l),g.fire({icon:"error",title:"Ø®Ø·Ø£",text:"ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù"})}})},j=()=>{u.value=[],y.value=null,F.value=!1,d.value=null,ce(()=>{T.value&&T.value.resetValidation()})};ue(()=>{h&&te()});const oe=async(a,e)=>{try{await _.put(`/api/tilawa-khatma-assignments/${a.id}`,{khatma_id:a.khatma_id,user_id:a.user_id,parts:a.parts,read:e}),g.fire({icon:"success",title:"ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©",showConfirmButton:!1,timer:1500})}catch(l){a.read=!e,console.error("Error updating read status:",l),g.fire({icon:"error",title:"Ø­Ø¯Ø« Ø®Ø·Ø£",text:"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©"})}};return(a,e)=>(i(),w(_e,{class:"q-pa-md"},{default:r(()=>{var l;return[n("div",he,[s(A,{flat:"",round:"",color:"primary",icon:"arrow_forward",onClick:e[0]||(e[0]=t=>a.$router.push("/khatma-tilawa"))}),n("div",be,[e[3]||(e[3]=n("div",{class:"text-h5 text-primary text-weight-bold"},"ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡",-1)),b.value?(i(),f("div",ke,c(b.value.khatma_no||"Ø§Ù„Ø®ØªÙ…Ø©")+" - "+c((l=b.value.group)==null?void 0:l.name),1)):Q("",!0)])]),R.value?(i(),f("div",xe,[s(de,{color:"primary",size:"3em"})])):(i(),f("div",we,[n("div",Ce,[s(M,{class:"glass-card q-pa-md"},{default:r(()=>[s(L,null,{default:r(()=>[e[4]||(e[4]=n("div",{class:"text-h6 text-primary q-mb-md"},"ØªØ¹ÙŠÙŠÙ† Ø¬Ø¯ÙŠØ¯",-1)),s(fe,{ref_key:"assignForm",ref:T,onSubmit:se,class:"q-gutter-md"},{default:r(()=>[s(J,{filled:"",modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),options:V.value,"option-value":"id","option-label":"name",label:"Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø±Ø¦",color:"primary","emit-value":"","map-options":"","use-input":"",onFilter:ae,rules:[t=>!!t||"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§Ø±Ø¦"]},{prepend:r(()=>[s(O,{name:"person",color:"primary"})]),option:r(t=>[s($,G(N(t.itemProps)),{default:r(()=>[s(C,null,{default:r(()=>[s(q,null,{default:r(()=>[p(c(t.opt.name),1)]),_:2},1024),t.opt.phone?(i(),w(q,{key:0,caption:""},{default:r(()=>[p(c(t.opt.phone),1)]),_:2},1024)):Q("",!0)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"]),s(J,{filled:"",modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value=t),options:X.value,label:"Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡",multiple:"","use-chips":"","stack-label":"",color:"primary","emit-value":"","map-options":"",rules:[t=>t&&t.length>0||"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡"]},{prepend:r(()=>[s(O,{name:"format_list_numbered",color:"primary"})]),option:r(({itemProps:t,opt:o,selected:x,toggleOption:ne})=>[s($,G(N(t)),{default:r(()=>[s(C,null,{default:r(()=>[s(q,null,{default:r(()=>[p("Ø§Ù„Ø¬Ø²Ø¡ "+c(k(o)),1)]),_:2},1024)]),_:2},1024),s(C,{side:""},{default:r(()=>[s(H,{"model-value":x,"onUpdate:modelValue":je=>ne(o)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),"selected-item":r(({opt:t})=>[s(ve,{dense:"",class:"q-ma-xs",color:"primary","text-color":"white",removable:"",onRemove:o=>u.value=u.value.filter(x=>x!==t)},{default:r(()=>[p(" Ø§Ù„Ø¬Ø²Ø¡ "+c(k(t)),1)]),_:2},1032,["onRemove"])]),_:1},8,["modelValue","options","rules"]),s(A,{label:d.value?"ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¹ÙŠÙŠÙ†":"Ø­ÙØ¸ Ø§Ù„ØªØ¹ÙŠÙŠÙ†",type:"submit",color:"primary",class:"full-width q-mt-md",unelevated:"",disable:u.value.length===0||!y.value,loading:z.value},null,8,["label","disable","loading"]),d.value?(i(),w(A,{key:0,label:"Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„",flat:"",color:"grey",class:"full-width q-mt-sm",onClick:j})):Q("",!0)]),_:1},512)]),_:1})]),_:1}),s(M,{class:"glass-card q-mt-md"},{default:r(()=>[s(L,null,{default:r(()=>[e[6]||(e[6]=n("div",{class:"text-h6 text-primary q-mb-sm"},"Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©",-1)),s(pe,{separator:""},{default:r(()=>[(i(!0),f(D,null,I(m.value,t=>(i(),w($,{key:t.id},{default:r(()=>[s(C,null,{default:r(()=>[s(q,null,{default:r(()=>{var o;return[p(c((o=t.user)==null?void 0:o.name),1)]}),_:2},1024),s(q,{caption:""},{default:r(()=>[p(" Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡: "+c(t.parts?t.parts.map(k).join(", "):""),1)]),_:2},1024)]),_:2},1024),s(C,{side:""},{default:r(()=>[n("div",Ae,[s(H,{size:"sm",modelValue:t.read,"onUpdate:modelValue":[o=>t.read=o,o=>oe(t,o)],color:"teal",label:t.read?"ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©":"Ù„Ù… ØªØªÙ… Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©","left-label":""},null,8,["modelValue","onUpdate:modelValue","label"]),s(A,{flat:"",round:"",color:"primary",icon:"edit",size:"sm",onClick:o=>le(t)},null,8,["onClick"]),s(A,{flat:"",round:"",color:"red",icon:"delete",size:"sm",onClick:o=>re(t)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128)),m.value.length===0?(i(),w($,{key:0},{default:r(()=>[s(C,{class:"text-grey text-center"},{default:r(()=>[...e[5]||(e[5]=[p("Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹ÙŠÙŠÙ†Ø§Øª Ø¨Ø¹Ø¯",-1)])]),_:1})]),_:1})):Q("",!0)]),_:1})]),_:1})]),_:1})]),n("div",Qe,[(i(!0),f(D,null,I(U.value,t=>(i(),f("div",{key:t,class:"q-mb-lg"},[s(M,{class:"glass-card q-pa-md"},{default:r(()=>[s(L,null,{default:r(()=>[n("div",qe,[n("div",Pe,[p(c(U.value>1?`Ø§Ù„Ø®ØªÙ…Ø© ${t}`:"Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡")+" ",1),U.value>1?(i(),f("span",Ve," (Ù…Ù† "+c(k((t-1)*30+1))+" Ø¥Ù„Ù‰ "+c(k(Math.min(t*30,B.value)))+") ",1)):Q("",!0)]),e[7]||(e[7]=n("div",{class:"row q-gutter-x-md text-caption"},[n("div",{class:"row items-center"},[n("div",{class:"legend-box bg-grey-2"}),p(" Ù…ØªØ§Ø­ ")]),n("div",{class:"row items-center"},[n("div",{class:"legend-box bg-amber border-grey"}),p(" Ù…Ø­Ø¯Ø¯ ")]),n("div",{class:"row items-center"},[n("div",{class:"legend-box bg-amber text-black"},"ðŸ‘¤"),p(" Ù…Ø­Ø¬ÙˆØ²Ø¡ ")]),n("div",{class:"row items-center"},[n("div",{class:"legend-box bg-teal text-white"},"âœ“"),p(" Ù…Ù‚Ø±ÙˆØ¡ ")])],-1))]),n("div",Be,[(i(!0),f(D,null,I(W(t),o=>(i(),f("div",{key:o,class:me(["part-box",Z(o)]),onClick:x=>ee(o)},[n("div",$e,c(k(o)),1),n("div",Re,[S(o)?(i(),f("span",ze,c(Y(o)),1)):u.value.includes(o)?(i(),w(O,{key:1,name:"check",size:"sm"})):(i(),f("span",Ue,"Ù…ØªØ§Ø­"))])],10,Se))),128))])]),_:2},1024)]),_:2},1024)]))),128))])]))]}),_:1}))}},He=ye(Fe,[["__scopeId","data-v-92a7d282"]]);export{He as default};
