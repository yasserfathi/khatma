import{a2 as G,c as g,w as r,l as v,o as c,f as s,a as e,j as d,a5 as u,a8 as b,h as n,a7 as L,a9 as A,aa as M,Q as B,d as U,e as O,C as Q,ab as R,g as q,as as H,aq as J,k as m,ac as K}from"./index-776326c9.js";import{Q as S}from"./QBadge-1141666b.js";import{Q as W,a as V}from"./QTable-8e34d41f.js";import{Q as T}from"./QTooltip-82c0d486.js";import{Q as X}from"./QSpace-0963216b.js";import{S as i,Q as Y}from"./sweetalert2.esm.all-f6020d5c.js";import{a as Z,c as C,d as z}from"./format-ac96bbe5.js";import{Q as ee}from"./QForm-ef212b9f.js";import{Q as ae}from"./QPage-6bef6b9e.js";import{C as E}from"./ClosePopup-ef2d2dfb.js";import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";import"./QLinearProgress-b4cb347b.js";import"./position-engine-bd395f92.js";import"./QChip-007a5e04.js";const re={class:"row items-center justify-between q-mb-lg"},le={class:"row items-center q-gutter-x-md"},te={class:"row q-gutter-xs"},se={class:"row justify-center q-gutter-x-sm"},ne={class:"full-width row flex-center text-grey-6 q-pa-lg"},ie={class:"text-h6 text-weight-bold"},de={class:"row justify-end q-mt-xl"},ue={__name:"UserPage",setup(ce){const k=m([]),y=m([]),w=m(!1),p=m(!1),f=m(!1),t=m({id:null,name:"",email:"",phone:"",group_numbers:[],password:"",active:!0}),I=[{name:"id",label:"#",field:"id",sortable:!0,align:"left",style:"width: 50px"},{name:"name",label:"الاسم",field:"name",sortable:!0,align:"left"},{name:"phone",label:"رقم الهاتف",field:"phone",sortable:!0,align:"left"},{name:"group_numbers",label:"أرقام المجموعات",field:"group_numbers",align:"left"},{name:"active",label:"الحالة",field:"active",sortable:!0,align:"center",style:"width: 150px"},{name:"actions",label:"الإجراءات",field:"actions",align:"center",style:"width: 150px"}],x=async()=>{try{const l=await v.get("/api/groups");y.value=l.data}catch{console.error("Error fetching groups")}},_=async()=>{w.value=!0;try{const l=await v.get("/api/users");k.value=l.data}catch(l){console.error("Error fetching users:",l),i.fire({icon:"error",title:"فشل التحميل",text:"فشل تحميل المشتركين"})}finally{w.value=!1}},D=()=>{f.value=!1,t.value={id:null,name:"",email:"",phone:"",group_numbers:[],password:"",active:!0},x(),p.value=!0},P=l=>{f.value=!0,t.value={...l,password:"",active:!!l.active},x(),p.value=!0},$=async()=>{try{const l={...t.value};l.phone&&(l.phone=l.phone.replace(/\s+/g,"")),f.value?(l.password||delete l.password,await v.put(`/api/users/${t.value.id}`,l),i.fire({icon:"success",title:"تم التعديل",text:"تم تعديل بيانات المشترك بنجاح",timer:1500,showConfirmButton:!1})):(await v.post("/api/users",l),i.fire({icon:"success",title:"تم الإنشاء",text:"تم إنشاء المشترك بنجاح",timer:1500,showConfirmButton:!1})),p.value=!1,_()}catch(l){if(console.error("Error saving user:",l),l.response&&l.response.status===422){const o=l.response.data.message||"يرجى التحقق من المدخلات";i.fire({icon:"error",title:"خطأ",text:o})}else i.fire({icon:"error",title:"خطأ",text:"حدث خطأ أثناء الحفظ"})}},j=l=>{i.fire({title:"تأكيد الحذف",text:`هل أنت متأكد من حذف المشترك"${l.name}"؟`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"نعم، احذفه",cancelButtonText:"إلغاء"}).then(async o=>{if(o.isConfirmed)try{await v.delete(`/api/users/${l.id}`),i.fire("تم الحذف!","تم حذف المشتركبنجاح.","success"),_()}catch(a){console.error("Error deleting user:",a),i.fire({icon:"error",title:"خطأ",text:"فشل الحذف"})}})},N=l=>{const o=y.value.find(a=>a.id===l);return o?o.name:l};return G(()=>{x(),_()}),(l,o)=>(c(),g(ae,{class:"q-pa-md"},{default:r(()=>[s("div",re,[s("div",le,[e(d,{round:"",flat:"",color:"primary",icon:"arrow_forward",to:"/app"}),o[7]||(o[7]=s("div",null,[s("div",{class:"text-h4 text-primary text-weight-bold text-islamic"},"المشاركين"),s("div",{class:"text-subtitle2 text-grey-7"},"إدارة المشاركين")],-1))]),e(d,{unelevated:"",rounded:"",color:"primary",icon:"add",label:"مشترك جديد",onClick:D,class:"shadow-3 q-px-md"})]),e(B,{class:"glass-card q-pa-sm"},{default:r(()=>[e(W,{rows:k.value,columns:I,"row-key":"id",loading:w.value,flat:"",separator:"none",class:"bg-transparent text-grey-9 custom-table","table-header-class":"text-primary text-weight-bold bg-primary-1 rounded-borders"},{"body-cell-active":r(a=>[e(V,{props:a},{default:r(()=>[e(S,{rounded:"",color:a.row.active?"primary":"grey",class:"q-px-sm q-py-xs shadow-1"},{default:r(()=>[u(b(a.row.active?"نشط":"غير نشط")+" ",1),e(n,{name:a.row.active?"check_circle":"cancel",class:"q-ml-xs"},null,8,["name"])]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-group_numbers":r(a=>[e(V,{props:a},{default:r(()=>[s("div",te,[(c(!0),L(M,null,A(a.row.group_numbers,(h,F)=>(c(),g(S,{key:F,rounded:"",color:"primary",class:"q-px-sm q-py-xs"},{default:r(()=>[u(b(N(h)),1)]),_:2},1024))),128))])]),_:2},1032,["props"])]),"body-cell-actions":r(a=>[e(V,{props:a,"auto-width":""},{default:r(()=>[s("div",se,[e(d,{flat:"",round:"",color:"primary-7",icon:"edit",size:"sm",class:"bg-primary-1 action-btn",onClick:h=>P(a.row)},{default:r(()=>[e(T,null,{default:r(()=>[...o[8]||(o[8]=[u("تعديل",-1)])]),_:1})]),_:1},8,["onClick"]),e(d,{flat:"",round:"",color:"red-7",icon:"delete",size:"sm",class:"bg-red-1 action-btn",onClick:h=>j(a.row)},{default:r(()=>[e(T,null,{default:r(()=>[...o[9]||(o[9]=[u("حذف",-1)])]),_:1})]),_:1},8,["onClick"])])]),_:2},1032,["props"])]),"no-data":r(()=>[s("div",ne,[e(n,{name:"warning",size:"sm",class:"q-mr-sm"}),o[10]||(o[10]=u(" لا يوجد مشتركين حالياً ",-1))])]),_:1},8,["rows","loading"])]),_:1}),e(J,{modelValue:p.value,"onUpdate:modelValue":o[6]||(o[6]=a=>p.value=a),"transition-show":"scale","transition-hide":"scale"},{default:r(()=>[e(B,{style:{"min-width":"450px","border-radius":"20px"},class:"shadow-24 overflow-hidden"},{default:r(()=>[e(U,{class:"bg-primary text-white row items-center q-py-md q-px-lg"},{default:r(()=>[e(O,{icon:"person",color:"primary-8","text-color":"white",size:"md",class:"q-mr-md"}),s("div",ie,b(f.value?"تعديل المشترك":"مشترك جديد"),1),e(X),Q(e(d,{icon:"close",flat:"",round:"",dense:"",class:"text-white op-70 hover-op-100"},null,512),[[E]])]),_:1}),e(R,{color:"primary-10"}),e(U,{class:"q-pa-lg"},{default:r(()=>[e(ee,{onSubmit:$,class:"q-gutter-md"},{default:r(()=>[e(q,{filled:"",dense:"",modelValue:t.value.name,"onUpdate:modelValue":o[0]||(o[0]=a=>t.value.name=a),label:"الاسم",color:"primary","bg-color":"grey-1",class:"rounded-borders",rules:[a=>!!a||"يرجى إدخال الاسم"]},{prepend:r(()=>[e(n,{name:"person",color:"primary"})]),_:1},8,["modelValue","rules"]),e(q,{filled:"",dense:"",modelValue:t.value.email,"onUpdate:modelValue":o[1]||(o[1]=a=>t.value.email=a),label:"البريد الإلكتروني",color:"primary","bg-color":"grey-1",class:"rounded-borders"},{prepend:r(()=>[e(n,{name:"email",color:"primary"})]),_:1},8,["modelValue"]),e(q,{filled:"",dense:"",modelValue:t.value.phone,"onUpdate:modelValue":[o[2]||(o[2]=a=>t.value.phone=a),o[3]||(o[3]=a=>t.value.phone=a.replace(/\s+/g,""))],label:"رقم الهاتف",color:"primary","bg-color":"grey-1",class:"rounded-borders",rules:[a=>!!a||"يرجى إدخال رقم الهاتف"]},{prepend:r(()=>[e(n,{name:"phone",color:"primary"})]),_:1},8,["modelValue","rules"]),e(Y,{filled:"",dense:"",modelValue:t.value.group_numbers,"onUpdate:modelValue":o[4]||(o[4]=a=>t.value.group_numbers=a),label:"أرقام المجموعات",options:y.value,"option-value":"id","option-label":"name",multiple:"",counter:"","max-values":"10","emit-value":"","map-options":"","use-chips":"",color:"primary","bg-color":"grey-1",class:"rounded-borders",rules:[a=>a&&a.length>0||"يرجى اختيار مجموعة واحدة على الأقل"]},{prepend:r(()=>[e(n,{name:"list_alt",color:"primary"})]),_:1},8,["modelValue","options","rules"]),Q((c(),g(Z,{tag:"label",class:"bg-grey-1 rounded-borders q-pa-md border-primary-1"},{default:r(()=>[e(C,{avatar:""},{default:r(()=>[t.value.active?(c(),g(n,{key:0,name:"toggle_on",color:"primary",size:"md"})):(c(),g(n,{key:1,name:"toggle_off",color:"grey",size:"md"}))]),_:1}),e(C,null,{default:r(()=>[e(z,{class:"text-weight-bold text-grey-8"},{default:r(()=>[...o[11]||(o[11]=[u("حالة الحساب",-1)])]),_:1}),e(z,{caption:""},{default:r(()=>[u(b(t.value.active?"حساب نشط":"حساب معطل"),1)]),_:1})]),_:1}),e(C,{side:""},{default:r(()=>[e(H,{modelValue:t.value.active,"onUpdate:modelValue":o[5]||(o[5]=a=>t.value.active=a),color:"primary"},null,8,["modelValue"])]),_:1})]),_:1})),[[K]]),s("div",de,[Q(e(d,{label:"إلغاء",color:"grey-7",flat:"",class:"q-mr-sm"},null,512),[[E]]),e(d,{label:f.value?"حفظ التغييرات":"إنشاء المشترك",type:"submit",color:"primary",icon:"save",unelevated:"",class:"q-px-lg shadow-2",style:{"border-radius":"10px"}},null,8,["label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ce=oe(ue,[["__scopeId","data-v-e56936ae"]]);export{Ce as default};
