import{a2 as P,c as f,w as a,l as g,o as v,g as s,a as e,j as n,a5 as d,ab as x,f as m,Q,d as q,e as $,C as b,aa as j,h as E,ap as N,aq as U,k as p,ac as A}from"./index-f6542553.js";import{Q as F}from"./QBadge-fc16b46f.js";import{S as i,Q as L,a as C,C as V}from"./sweetalert2.esm.all-e81408ee.js";import{a as k,Q as M,e as R,f as _,g as B}from"./format-a673be16.js";import{Q as H}from"./QForm-33aa0eb1.js";import{Q as J}from"./QPage-562e756b.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import"./QLinearProgress-56de8674.js";const O={class:"row items-center justify-between q-mb-lg"},W={class:"row items-center q-gutter-x-md"},X={class:"row justify-center q-gutter-x-sm"},Y={class:"full-width row flex-center text-grey-6 q-pa-lg"},Z={class:"text-h6 text-weight-bold"},ee={class:"row justify-end q-mt-xl"},ae={__name:"GroupPage",setup(te){const h=p([]),y=p(!1),c=p(!1),u=p(!1),r=p({id:null,name:"",active:!0}),S=[{name:"name",label:"اسم المجموعة",field:"name",sortable:!0,align:"left"},{name:"active",label:"الحالة",field:"active",sortable:!0,align:"center",style:"width: 150px"},{name:"actions",label:"الإجراءات",field:"actions",align:"center",style:"width: 150px"}],w=async()=>{y.value=!0;try{const l=await g.get("/api/groups");h.value=l.data}catch(l){console.error("Error fetching groups:",l),i.fire({icon:"error",title:"فشل التحميل",text:"فشل تحميل المجموعات"})}finally{y.value=!1}},T=()=>{u.value=!1,r.value={id:null,name:"",active:!0},c.value=!0},z=l=>{u.value=!0,r.value={...l,active:!!l.active},c.value=!0},G=async()=>{try{u.value?(await g.put(`/api/groups/${r.value.id}`,r.value),i.fire({icon:"success",title:"تم التعديل",text:"تم تعديل المجموعة بنجاح",timer:1500,showConfirmButton:!1})):(await g.post("/api/groups",r.value),i.fire({icon:"success",title:"تم الإنشاء",text:"تم إنشاء المجموعة بنجاح",timer:1500,showConfirmButton:!1})),c.value=!1,w()}catch(l){if(console.error("Error saving group:",l),l.response&&l.response.status===422){const t=l.response.data.message||"بيانات غير صالحة";i.fire({icon:"error",title:"خطأ",text:t})}else i.fire({icon:"error",title:"خطأ",text:"حدث خطأ أثناء الحفظ"})}},I=l=>{i.fire({title:"تأكيد الحذف",text:`هل أنت متأكد من حذف المجموعة "${l.name}"؟`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"نعم، احذفها",cancelButtonText:"إلغاء"}).then(async t=>{if(t.isConfirmed)try{await g.delete(`/api/groups/${l.id}`),i.fire("تم الحذف!","تم حذف المجموعة بنجاح.","success"),w()}catch(o){console.error("Error deleting group:",o),i.fire({icon:"error",title:"خطأ",text:"فشل الحذف"})}})};return P(()=>{w()}),(l,t)=>(v(),f(J,{class:"q-pa-md"},{default:a(()=>[s("div",O,[s("div",W,[e(n,{round:"",flat:"",color:"primary",icon:"arrow_forward",to:"/app"}),t[3]||(t[3]=s("div",null,[s("div",{class:"text-h4 text-primary text-weight-bold text-islamic"},"المجموعات"),s("div",{class:"text-subtitle2 text-grey-7"},"إدارة مجموعات الختمة والمستخدمين")],-1))]),e(n,{unelevated:"",rounded:"",color:"primary",icon:"add",label:"مجموعة جديدة",onClick:T,class:"shadow-3 q-px-md"})]),e(Q,{class:"glass-card q-pa-sm"},{default:a(()=>[e(L,{rows:h.value,columns:S,"row-key":"id",loading:y.value,flat:"",separator:"none",class:"bg-transparent text-grey-9 custom-table","table-header-class":"text-primary text-weight-bold bg-primary-1 rounded-borders"},{"body-cell-active":a(o=>[e(C,{props:o},{default:a(()=>[e(F,{rounded:"",color:o.row.active?"primary":"grey",class:"q-px-sm q-py-xs shadow-1"},{default:a(()=>[d(x(o.row.active?"نشط":"غير نشط")+" ",1),e(m,{name:o.row.active?"check_circle":"cancel",class:"q-ml-xs"},null,8,["name"])]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-actions":a(o=>[e(C,{props:o,"auto-width":""},{default:a(()=>[s("div",X,[e(n,{flat:"",round:"",color:"primary-7",icon:"edit",size:"sm",class:"bg-primary-1 action-btn",onClick:D=>z(o.row)},{default:a(()=>[e(k,null,{default:a(()=>[...t[4]||(t[4]=[d("تعديل",-1)])]),_:1})]),_:1},8,["onClick"]),e(n,{flat:"",round:"",color:"red-7",icon:"delete",size:"sm",class:"bg-red-1 action-btn",onClick:D=>I(o.row)},{default:a(()=>[e(k,null,{default:a(()=>[...t[5]||(t[5]=[d("حذف",-1)])]),_:1})]),_:1},8,["onClick"])])]),_:2},1032,["props"])]),"no-data":a(()=>[s("div",Y,[e(m,{name:"warning",size:"sm",class:"q-mr-sm"}),t[6]||(t[6]=d(" لا توجد مجموعات حالياً ",-1))])]),_:1},8,["rows","loading"])]),_:1}),e(U,{modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=o=>c.value=o),"transition-show":"scale","transition-hide":"scale"},{default:a(()=>[e(Q,{style:{"min-width":"450px","border-radius":"20px"},class:"shadow-24 overflow-hidden"},{default:a(()=>[e(q,{class:"bg-primary text-white row items-center q-py-md q-px-lg"},{default:a(()=>[e($,{icon:"group",color:"primary-8","text-color":"white",size:"md",class:"q-mr-md"}),s("div",Z,x(u.value?"تعديل المجموعة":"مجموعة جديدة"),1),e(M),b(e(n,{icon:"close",flat:"",round:"",dense:"",class:"text-white op-70 hover-op-100"},null,512),[[V]])]),_:1}),e(j,{color:"primary-10"}),e(q,{class:"q-pa-lg"},{default:a(()=>[e(H,{onSubmit:G,class:"q-gutter-md"},{default:a(()=>[e(E,{filled:"",dense:"",modelValue:r.value.name,"onUpdate:modelValue":t[0]||(t[0]=o=>r.value.name=o),label:"اسم المجموعة",color:"primary","bg-color":"grey-1",class:"rounded-borders",rules:[o=>!!o||"يرجى إدخال الاسم"],placeholder:"مثال: ختمة رمضان"},{prepend:a(()=>[e(m,{name:"badge",color:"primary"})]),_:1},8,["modelValue","rules"]),b((v(),f(R,{tag:"label",class:"bg-grey-1 rounded-borders q-pa-md border-primary-1"},{default:a(()=>[e(_,{avatar:""},{default:a(()=>[r.value.active?(v(),f(m,{key:0,name:"toggle_on",color:"primary",size:"md"})):(v(),f(m,{key:1,name:"toggle_off",color:"grey",size:"md"}))]),_:1}),e(_,null,{default:a(()=>[e(B,{class:"text-weight-bold text-grey-8"},{default:a(()=>[...t[7]||(t[7]=[d("حالة المجموعة",-1)])]),_:1}),e(B,{caption:""},{default:a(()=>[d(x(r.value.active?"المجموعة نشطة ويمكن استخدامها":"المجموعة معطلة مؤقتاً"),1)]),_:1})]),_:1}),e(_,{side:""},{default:a(()=>[e(N,{modelValue:r.value.active,"onUpdate:modelValue":t[1]||(t[1]=o=>r.value.active=o),color:"primary"},null,8,["modelValue"])]),_:1})]),_:1})),[[A]]),s("div",ee,[b(e(n,{label:"إلغاء",color:"grey-7",flat:"",class:"q-mr-sm"},null,512),[[V]]),e(n,{label:u.value?"حفظ التغييرات":"إنشاء المجموعة",type:"submit",color:"primary",icon:"save",unelevated:"",class:"q-px-lg shadow-2",style:{"border-radius":"10px"}},null,8,["label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ue=K(ae,[["__scopeId","data-v-28097418"]]);export{ue as default};
