import{a2 as G,c as g,w as r,l as v,o as c,g as s,a as e,j as d,a5 as u,a8 as b,f as i,a7 as L,a9 as A,aa as M,Q as B,d as U,e as O,C as Q,ab as R,h as q,ar as H,as as J,k as m,ac as K}from"./index-fb423868.js";import{Q as S}from"./QBadge-06193652.js";import{Q as W,a as V}from"./QTable-5a681be7.js";import{Q as T}from"./QTooltip-5adacf3a.js";import{Q as X}from"./QSpace-a87ff49f.js";import{S as n,Q as Y}from"./sweetalert2.esm.all-a61fabd4.js";import{a as Z,c as C,d as z}from"./format-1ba3b2e1.js";import{Q as ee}from"./QForm-ac163a32.js";import{Q as ae}from"./QPage-c4af3978.js";import{C as E}from"./ClosePopup-8f59abc6.js";import{_ as re}from"./_plugin-vue_export-helper-c27b6911.js";import"./QLinearProgress-9302dcdc.js";import"./position-engine-c8cf3575.js";const le={class:"row items-center justify-between q-mb-lg"},oe={class:"row items-center q-gutter-x-md"},te={class:"row q-gutter-xs"},se={class:"row justify-center q-gutter-x-sm"},ie={class:"full-width row flex-center text-grey-6 q-pa-lg"},ne={class:"text-h6 text-weight-bold"},de={class:"row justify-end q-mt-xl"},ue={__name:"UserPage",setup(ce){const k=m([]),y=m([]),w=m(!1),p=m(!1),f=m(!1),t=m({id:null,name:"",email:"",phone:"",group_numbers:[],password:"",active:!0}),I=[{name:"id",label:"#",field:"id",sortable:!0,align:"left",style:"width: 50px"},{name:"name",label:"الاسم",field:"name",sortable:!0,align:"left"},{name:"phone",label:"رقم الهاتف",field:"phone",sortable:!0,align:"left"},{name:"group_numbers",label:"أرقام المجموعات",field:"group_numbers",align:"left"},{name:"active",label:"الحالة",field:"active",sortable:!0,align:"center",style:"width: 150px"},{name:"actions",label:"الإجراءات",field:"actions",align:"center",style:"width: 150px"}],_=async()=>{try{const o=await v.get("/api/groups");y.value=o.data}catch{console.error("Error fetching groups")}},x=async()=>{w.value=!0;try{const o=await v.get("/api/users");k.value=o.data}catch(o){console.error("Error fetching users:",o),n.fire({icon:"error",title:"فشل التحميل",text:"فشل تحميل المشتركين"})}finally{w.value=!1}},D=()=>{f.value=!1,t.value={id:null,name:"",email:"",phone:"",group_numbers:[],password:"",active:!0},_(),p.value=!0},P=o=>{f.value=!0,t.value={...o,password:"",active:!!o.active},_(),p.value=!0},$=async()=>{try{const o={...t.value};f.value?(o.password||delete o.password,await v.put(`/api/users/${t.value.id}`,o),n.fire({icon:"success",title:"تم التعديل",text:"تم تعديل بيانات المشترك بنجاح",timer:1500,showConfirmButton:!1})):(await v.post("/api/users",o),n.fire({icon:"success",title:"تم الإنشاء",text:"تم إنشاء المشترك بنجاح",timer:1500,showConfirmButton:!1})),p.value=!1,x()}catch(o){if(console.error("Error saving user:",o),o.response&&o.response.status===422){const l=o.response.data.message||"يرجى التحقق من المدخلات";n.fire({icon:"error",title:"خطأ",text:l})}else n.fire({icon:"error",title:"خطأ",text:"حدث خطأ أثناء الحفظ"})}},j=o=>{n.fire({title:"تأكيد الحذف",text:`هل أنت متأكد من حذف المشترك"${o.name}"؟`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"نعم، احذفه",cancelButtonText:"إلغاء"}).then(async l=>{if(l.isConfirmed)try{await v.delete(`/api/users/${o.id}`),n.fire("تم الحذف!","تم حذف المشتركبنجاح.","success"),x()}catch(a){console.error("Error deleting user:",a),n.fire({icon:"error",title:"خطأ",text:"فشل الحذف"})}})},N=o=>{const l=y.value.find(a=>a.id===o);return l?l.name:o};return G(()=>{_(),x()}),(o,l)=>(c(),g(ae,{class:"q-pa-md"},{default:r(()=>[s("div",le,[s("div",oe,[e(d,{round:"",flat:"",color:"primary",icon:"arrow_forward",to:"/app"}),l[6]||(l[6]=s("div",null,[s("div",{class:"text-h4 text-primary text-weight-bold text-islamic"},"المشاركين"),s("div",{class:"text-subtitle2 text-grey-7"},"إدارة المشاركين")],-1))]),e(d,{unelevated:"",rounded:"",color:"primary",icon:"add",label:"مشترك جديد",onClick:D,class:"shadow-3 q-px-md"})]),e(B,{class:"glass-card q-pa-sm"},{default:r(()=>[e(W,{rows:k.value,columns:I,"row-key":"id",loading:w.value,flat:"",separator:"none",class:"bg-transparent text-grey-9 custom-table","table-header-class":"text-primary text-weight-bold bg-primary-1 rounded-borders"},{"body-cell-active":r(a=>[e(V,{props:a},{default:r(()=>[e(S,{rounded:"",color:a.row.active?"primary":"grey",class:"q-px-sm q-py-xs shadow-1"},{default:r(()=>[u(b(a.row.active?"نشط":"غير نشط")+" ",1),e(i,{name:a.row.active?"check_circle":"cancel",class:"q-ml-xs"},null,8,["name"])]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-group_numbers":r(a=>[e(V,{props:a},{default:r(()=>[s("div",te,[(c(!0),L(M,null,A(a.row.group_numbers,(h,F)=>(c(),g(S,{key:F,rounded:"",color:"primary",class:"q-px-sm q-py-xs"},{default:r(()=>[u(b(N(h)),1)]),_:2},1024))),128))])]),_:2},1032,["props"])]),"body-cell-actions":r(a=>[e(V,{props:a,"auto-width":""},{default:r(()=>[s("div",se,[e(d,{flat:"",round:"",color:"primary-7",icon:"edit",size:"sm",class:"bg-primary-1 action-btn",onClick:h=>P(a.row)},{default:r(()=>[e(T,null,{default:r(()=>[...l[7]||(l[7]=[u("تعديل",-1)])]),_:1})]),_:1},8,["onClick"]),e(d,{flat:"",round:"",color:"red-7",icon:"delete",size:"sm",class:"bg-red-1 action-btn",onClick:h=>j(a.row)},{default:r(()=>[e(T,null,{default:r(()=>[...l[8]||(l[8]=[u("حذف",-1)])]),_:1})]),_:1},8,["onClick"])])]),_:2},1032,["props"])]),"no-data":r(()=>[s("div",ie,[e(i,{name:"warning",size:"sm",class:"q-mr-sm"}),l[9]||(l[9]=u(" لا يوجد مشتركين حالياً ",-1))])]),_:1},8,["rows","loading"])]),_:1}),e(J,{modelValue:p.value,"onUpdate:modelValue":l[5]||(l[5]=a=>p.value=a),"transition-show":"scale","transition-hide":"scale"},{default:r(()=>[e(B,{style:{"min-width":"450px","border-radius":"20px"},class:"shadow-24 overflow-hidden"},{default:r(()=>[e(U,{class:"bg-primary text-white row items-center q-py-md q-px-lg"},{default:r(()=>[e(O,{icon:"person",color:"primary-8","text-color":"white",size:"md",class:"q-mr-md"}),s("div",ne,b(f.value?"تعديل المشترك":"مشترك جديد"),1),e(X),Q(e(d,{icon:"close",flat:"",round:"",dense:"",class:"text-white op-70 hover-op-100"},null,512),[[E]])]),_:1}),e(R,{color:"primary-10"}),e(U,{class:"q-pa-lg"},{default:r(()=>[e(ee,{onSubmit:$,class:"q-gutter-md"},{default:r(()=>[e(q,{filled:"",dense:"",modelValue:t.value.name,"onUpdate:modelValue":l[0]||(l[0]=a=>t.value.name=a),label:"الاسم",color:"primary","bg-color":"grey-1",class:"rounded-borders",rules:[a=>!!a||"يرجى إدخال الاسم"]},{prepend:r(()=>[e(i,{name:"person",color:"primary"})]),_:1},8,["modelValue","rules"]),e(q,{filled:"",dense:"",modelValue:t.value.email,"onUpdate:modelValue":l[1]||(l[1]=a=>t.value.email=a),label:"البريد الإلكتروني",color:"primary","bg-color":"grey-1",class:"rounded-borders"},{prepend:r(()=>[e(i,{name:"email",color:"primary"})]),_:1},8,["modelValue"]),e(q,{filled:"",dense:"",modelValue:t.value.phone,"onUpdate:modelValue":l[2]||(l[2]=a=>t.value.phone=a),label:"رقم الهاتف",color:"primary","bg-color":"grey-1",class:"rounded-borders",rules:[a=>!!a||"يرجى إدخال رقم الهاتف"]},{prepend:r(()=>[e(i,{name:"phone",color:"primary"})]),_:1},8,["modelValue","rules"]),e(Y,{filled:"",dense:"",modelValue:t.value.group_numbers,"onUpdate:modelValue":l[3]||(l[3]=a=>t.value.group_numbers=a),label:"أرقام المجموعات",options:y.value,"option-value":"id","option-label":"name",multiple:"",counter:"","max-values":"10","emit-value":"","map-options":"","use-chips":"",color:"primary","bg-color":"grey-1",class:"rounded-borders",rules:[a=>a&&a.length>0||"يرجى اختيار مجموعة واحدة على الأقل"]},{prepend:r(()=>[e(i,{name:"list_alt",color:"primary"})]),_:1},8,["modelValue","options","rules"]),Q((c(),g(Z,{tag:"label",class:"bg-grey-1 rounded-borders q-pa-md border-primary-1"},{default:r(()=>[e(C,{avatar:""},{default:r(()=>[t.value.active?(c(),g(i,{key:0,name:"toggle_on",color:"primary",size:"md"})):(c(),g(i,{key:1,name:"toggle_off",color:"grey",size:"md"}))]),_:1}),e(C,null,{default:r(()=>[e(z,{class:"text-weight-bold text-grey-8"},{default:r(()=>[...l[10]||(l[10]=[u("حالة الحساب",-1)])]),_:1}),e(z,{caption:""},{default:r(()=>[u(b(t.value.active?"حساب نشط":"حساب معطل"),1)]),_:1})]),_:1}),e(C,{side:""},{default:r(()=>[e(H,{modelValue:t.value.active,"onUpdate:modelValue":l[4]||(l[4]=a=>t.value.active=a),color:"primary"},null,8,["modelValue"])]),_:1})]),_:1})),[[K]]),s("div",de,[Q(e(d,{label:"إلغاء",color:"grey-7",flat:"",class:"q-mr-sm"},null,512),[[E]]),e(d,{label:f.value?"حفظ التغييرات":"إنشاء المشترك",type:"submit",color:"primary",icon:"save",unelevated:"",class:"q-px-lg shadow-2",style:{"border-radius":"10px"}},null,8,["label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ve=re(ue,[["__scopeId","data-v-101326a5"]]);export{Ve as default};
