import{a2 as $,c as f,w as l,l as g,o as v,g as s,a as e,j as n,a5 as d,a8 as x,f as c,Q as q,d as C,e as j,C as _,ab as E,h as U,ar as N,as as A,k as p,ac as F}from"./index-fb423868.js";import{Q as L}from"./QBadge-06193652.js";import{Q as M,a as V}from"./QTable-5a681be7.js";import{Q as k}from"./QTooltip-5adacf3a.js";import{Q as O}from"./QSpace-a87ff49f.js";import{S as i,Q as R}from"./sweetalert2.esm.all-a61fabd4.js";import{a as H,c as Q,d as B}from"./format-1ba3b2e1.js";import{Q as J}from"./QForm-ac163a32.js";import{Q as K}from"./QPage-c4af3978.js";import{C as S}from"./ClosePopup-8f59abc6.js";import{_ as W}from"./_plugin-vue_export-helper-c27b6911.js";import"./QLinearProgress-9302dcdc.js";import"./position-engine-c8cf3575.js";const X={class:"row items-center justify-between q-mb-lg"},Y={class:"row items-center q-gutter-x-md"},Z={class:"row justify-center q-gutter-x-sm"},ee={class:"full-width row flex-center text-grey-6 q-pa-lg"},ae={class:"text-h6 text-weight-bold"},te={class:"row justify-end q-mt-xl"},le={__name:"GroupPage",setup(oe){const h=p([]),y=p(!1),u=p(!1),m=p(!1),r=p({id:null,name:"",active:!0,type:"tilawa"}),z=[{label:"تلاوة",value:"tilawa"},{label:"ذكر",value:"zikr"}],T=[{name:"name",label:"اسم المجموعة",field:"name",sortable:!0,align:"left"},{name:"type",label:"النوع",field:o=>o.type==="zikr"?"ذكر":"تلاوة",sortable:!0,align:"center"},{name:"active",label:"الحالة",field:"active",sortable:!0,align:"center",style:"width: 150px"},{name:"actions",label:"الإجراءات",field:"actions",align:"center",style:"width: 150px"}],b=async()=>{var o,t;y.value=!0;try{const a=await g.get("/api/groups");h.value=a.data}catch(a){console.error("Error fetching groups:",a);const w=((t=(o=a.response)==null?void 0:o.data)==null?void 0:t.message)||a.message||"فشل تحميل المجموعات";i.fire({icon:"error",title:"فشل التحميل",text:w})}finally{y.value=!1}},G=()=>{m.value=!1,r.value={id:null,name:"",active:!0,type:"tilawa"},u.value=!0},I=o=>{m.value=!0,r.value={...o,active:!!o.active,type:o.type||"tilawa"},u.value=!0},D=async()=>{try{m.value?(await g.put(`/api/groups/${r.value.id}`,r.value),i.fire({icon:"success",title:"تم التعديل",text:"تم تعديل المجموعة بنجاح",timer:1500,showConfirmButton:!1})):(await g.post("/api/groups",r.value),i.fire({icon:"success",title:"تم الإنشاء",text:"تم إنشاء المجموعة بنجاح",timer:1500,showConfirmButton:!1})),u.value=!1,b()}catch(o){if(console.error("Error saving group:",o),o.response&&o.response.status===422){const t=o.response.data.message||"بيانات غير صالحة";i.fire({icon:"error",title:"خطأ",text:t})}else i.fire({icon:"error",title:"خطأ",text:"حدث خطأ أثناء الحفظ"})}},P=o=>{i.fire({title:"تأكيد الحذف",text:`هل أنت متأكد من حذف المجموعة "${o.name}"؟`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"نعم، احذفها",cancelButtonText:"إلغاء"}).then(async t=>{if(t.isConfirmed)try{await g.delete(`/api/groups/${o.id}`),i.fire("تم الحذف!","تم حذف المجموعة بنجاح.","success"),b()}catch(a){console.error("Error deleting group:",a),i.fire({icon:"error",title:"خطأ",text:"فشل الحذف"})}})};return $(()=>{b()}),(o,t)=>(v(),f(K,{class:"q-pa-md"},{default:l(()=>[s("div",X,[s("div",Y,[e(n,{round:"",flat:"",color:"primary",icon:"arrow_forward",to:"/app"}),t[4]||(t[4]=s("div",null,[s("div",{class:"text-h4 text-primary text-weight-bold text-islamic"},"المجموعات"),s("div",{class:"text-subtitle2 text-grey-7"},"إدارة مجموعات الختمة والمستخدمين")],-1))]),e(n,{unelevated:"",rounded:"",color:"primary",icon:"add",label:"مجموعة جديدة",onClick:G,class:"shadow-3 q-px-md"})]),e(q,{class:"glass-card q-pa-sm"},{default:l(()=>[e(M,{rows:h.value,columns:T,"row-key":"id",loading:y.value,flat:"",separator:"none",class:"bg-transparent text-grey-9 custom-table","table-header-class":"text-primary text-weight-bold bg-primary-1 rounded-borders"},{"body-cell-active":l(a=>[e(V,{props:a},{default:l(()=>[e(L,{rounded:"",color:a.row.active?"primary":"grey",class:"q-px-sm q-py-xs shadow-1"},{default:l(()=>[d(x(a.row.active?"نشط":"غير نشط")+" ",1),e(c,{name:a.row.active?"check_circle":"cancel",class:"q-ml-xs"},null,8,["name"])]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-actions":l(a=>[e(V,{props:a,"auto-width":""},{default:l(()=>[s("div",Z,[e(n,{flat:"",round:"",color:"primary-7",icon:"edit",size:"sm",class:"bg-primary-1 action-btn",onClick:w=>I(a.row)},{default:l(()=>[e(k,null,{default:l(()=>[...t[5]||(t[5]=[d("تعديل",-1)])]),_:1})]),_:1},8,["onClick"]),e(n,{flat:"",round:"",color:"red-7",icon:"delete",size:"sm",class:"bg-red-1 action-btn",onClick:w=>P(a.row)},{default:l(()=>[e(k,null,{default:l(()=>[...t[6]||(t[6]=[d("حذف",-1)])]),_:1})]),_:1},8,["onClick"])])]),_:2},1032,["props"])]),"no-data":l(()=>[s("div",ee,[e(c,{name:"warning",size:"sm",class:"q-mr-sm"}),t[7]||(t[7]=d(" لا توجد مجموعات حالياً ",-1))])]),_:1},8,["rows","loading"])]),_:1}),e(A,{modelValue:u.value,"onUpdate:modelValue":t[3]||(t[3]=a=>u.value=a),"transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(q,{style:{"min-width":"450px","border-radius":"20px"},class:"shadow-24 overflow-hidden"},{default:l(()=>[e(C,{class:"bg-primary text-white row items-center q-py-md q-px-lg"},{default:l(()=>[e(j,{icon:"group",color:"primary-8","text-color":"white",size:"md",class:"q-mr-md"}),s("div",ae,x(m.value?"تعديل المجموعة":"مجموعة جديدة"),1),e(O),_(e(n,{icon:"close",flat:"",round:"",dense:"",class:"text-white op-70 hover-op-100"},null,512),[[S]])]),_:1}),e(E,{color:"primary-10"}),e(C,{class:"q-pa-lg"},{default:l(()=>[e(J,{onSubmit:D,class:"q-gutter-md"},{default:l(()=>[e(U,{filled:"",dense:"",modelValue:r.value.name,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value.name=a),label:"اسم المجموعة",color:"primary","bg-color":"grey-1",class:"rounded-borders",rules:[a=>!!a||"يرجى إدخال الاسم"],placeholder:"مثال: ختمة رمضان"},{prepend:l(()=>[e(c,{name:"badge",color:"primary"})]),_:1},8,["modelValue","rules"]),e(R,{filled:"",dense:"",modelValue:r.value.type,"onUpdate:modelValue":t[1]||(t[1]=a=>r.value.type=a),options:z,"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"نوع المجموعة",color:"primary","bg-color":"grey-1",class:"rounded-borders",rules:[a=>!!a||"يرجى اختيار النوع"]},{prepend:l(()=>[e(c,{name:"category",color:"primary"})]),_:1},8,["modelValue","rules"]),_((v(),f(H,{tag:"label",class:"bg-grey-1 rounded-borders q-pa-md border-primary-1"},{default:l(()=>[e(Q,{avatar:""},{default:l(()=>[r.value.active?(v(),f(c,{key:0,name:"toggle_on",color:"primary",size:"md"})):(v(),f(c,{key:1,name:"toggle_off",color:"grey",size:"md"}))]),_:1}),e(Q,null,{default:l(()=>[e(B,{class:"text-weight-bold text-grey-8"},{default:l(()=>[...t[8]||(t[8]=[d("حالة المجموعة",-1)])]),_:1}),e(B,{caption:""},{default:l(()=>[d(x(r.value.active?"المجموعة نشطة ويمكن استخدامها":"المجموعة معطلة مؤقتاً"),1)]),_:1})]),_:1}),e(Q,{side:""},{default:l(()=>[e(N,{modelValue:r.value.active,"onUpdate:modelValue":t[2]||(t[2]=a=>r.value.active=a),color:"primary"},null,8,["modelValue"])]),_:1})]),_:1})),[[F]]),s("div",te,[_(e(n,{label:"إلغاء",color:"grey-7",flat:"",class:"q-mr-sm"},null,512),[[S]]),e(n,{label:m.value?"حفظ التغييرات":"إنشاء المجموعة",type:"submit",color:"primary",icon:"save",unelevated:"",class:"q-px-lg shadow-2",style:{"border-radius":"10px"}},null,8,["label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},be=W(le,[["__scopeId","data-v-e27e4eef"]]);export{be as default};
