import{a2 as S,c as b,w as l,l as p,o as u,f as s,a as t,j as h,d as z,Q as w,a7 as x,av as B,g as C,k as c}from"./app-0ed78742.js";import{Q as N,S as _}from"./sweetalert2.esm.all-c018c2c0.js";import{Q as E}from"./QSpace-d597acc7.js";import{a as U,Q as j}from"./QTable-8284a098.js";import{Q as A}from"./QPage-3f84e0e7.js";import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";import"./QChip-92718629.js";import"./format-dfd5180a.js";import"./position-engine-402b4c53.js";import"./QLinearProgress-80fe61c1.js";const M={class:"row items-center q-mb-lg"},R={class:"row items-center q-col-gutter-md"},T={class:"col-12 col-sm-6"},$={class:"col-auto"},D={key:0,class:"row justify-center q-py-xl"},F={key:2,class:"text-center q-pa-xl text-grey-6"},H={__name:"ParticipantNumbersPage",setup(I){const d=c(!1),m=c(!1),i=c(null),g=c([]),n=c([]),k=[{name:"name",label:"الاسم",field:"name",align:"left"},{name:"phone",label:"رقم الهاتف",field:"phone",align:"left"},{name:"participant_no",label:"رقم المشارك",field:"participant_no",align:"center"}],Q=async()=>{try{const e=await p.get("/api/groups",{params:{type:"zikr"}});g.value=e.data}catch(e){console.error("Error fetching groups:",e)}},P=async e=>{if(e){d.value=!0,n.value=[];try{const[a,r]=await Promise.all([p.get("/api/users"),p.get("/api/zikr-group-participants",{params:{group_id:e}})]),f=(a.data||[]).filter(o=>{var y;return(y=o.group_numbers)==null?void 0:y.some(V=>String(V)===String(e))}),v={};Array.isArray(r.data)&&r.data.forEach(o=>{v[o.user_id]=o.participant_no}),n.value=f.map(o=>({user_id:o.id,name:o.name,phone:o.phone,participant_no:v[o.id]||""}))}catch(a){console.error("Error fetching participants:",a),_.fire("خطأ","فشل تحميل المشاركين","error")}finally{d.value=!1}}},q=async()=>{if(i.value){m.value=!0;try{const e={group_id:i.value,participants:n.value.map(a=>({user_id:a.user_id,participant_no:a.participant_no}))};await p.post("/api/zikr-group-participants/bulk",e),_.fire({icon:"success",title:"تم الحفظ",text:"تم تحديث أرقام المشاركين بنجاح",timer:1500,showConfirmButton:!1})}catch(e){console.error("Error saving numbers:",e),_.fire("خطأ","فشل حفظ التغييرات","error")}finally{m.value=!1}}};return S(Q),(e,a)=>(u(),b(A,{class:"q-pa-md"},{default:l(()=>[s("div",M,[t(h,{flat:"",round:"",color:"primary",icon:"arrow_forward",onClick:a[0]||(a[0]=r=>e.$router.push("/khatma-zikr"))}),a[2]||(a[2]=s("div",{class:"q-ml-md"},[s("div",{class:"text-h5 text-primary text-weight-bold"},"ترقيم المشاركين (مجموعات الذكر)"),s("div",{class:"text-subtitle2 text-grey-7"},"تخصيص أرقام للمشاركين في كل مجموعة")],-1))]),t(w,{class:"glass-card q-mb-lg q-pa-sm"},{default:l(()=>[t(z,null,{default:l(()=>[s("div",R,[s("div",T,[t(N,{filled:"",modelValue:i.value,"onUpdate:modelValue":[a[1]||(a[1]=r=>i.value=r),P],options:g.value,"option-value":"id","option-label":"name",label:"اختر مجموعة الذكر","emit-value":"","map-options":""},null,8,["modelValue","options"])]),t(E),s("div",$,[t(h,{label:"حفظ التغييرات",color:"primary",icon:"save",unelevated:"",loading:m.value,disable:!i.value||n.value.length===0,onClick:q},null,8,["loading","disable"])])])]),_:1})]),_:1}),d.value?(u(),x("div",D,[t(B,{color:"primary",size:"3em"})])):i.value?(u(),b(w,{key:1,class:"glass-card"},{default:l(()=>[t(j,{rows:n.value,columns:k,"row-key":"user_id",flat:"",pagination:{rowsPerPage:0},"hide-pagination":""},{"body-cell-participant_no":l(r=>[t(U,{props:r},{default:l(()=>[t(C,{modelValue:r.row.participant_no,"onUpdate:modelValue":f=>r.row.participant_no=f,dense:"",filled:"",placeholder:"مثلا: 101",style:{"max-width":"150px"},class:"q-mx-auto"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"no-data":l(()=>[...a[3]||(a[3]=[s("div",{class:"full-width row flex-center text-grey-6 q-pa-lg"}," لا يوجد مشاركين في هذه المجموعة ",-1)])]),_:1},8,["rows"])]),_:1})):(u(),x("div",F," يرجى اختيار مجموعة لعرض المشاركين "))]),_:1}))}},ta=G(H,[["__scopeId","data-v-aea0e3f7"]]);export{ta as default};
