import{a2 as G,c as p,w as o,l as v,o as d,g as s,a as e,j as u,a5 as c,ab as y,f as n,a7 as L,a8 as A,a9 as M,Q as B,d as U,e as O,C as V,aa as R,h as b,a6 as H,ao as J,ap as K,k as f,ac as W}from"./app-d75ee512.js";import{Q as S}from"./QBadge-7ac72906.js";import{S as i,Q as X,a as q,b as Y,C as T}from"./sweetalert2.esm.all-656f7692.js";import{a as z,Q as Z,e as ee,f as C,g as E}from"./format-8df1824e.js";import{Q as ae}from"./QForm-f985544d.js";import{Q as le}from"./QPage-fd16ef0c.js";import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";import"./QLinearProgress-5814a24c.js";const re={class:"row items-center justify-between q-mb-lg"},te={class:"row items-center q-gutter-x-md"},se={class:"row q-gutter-xs"},ne={class:"row justify-center q-gutter-x-sm"},ie={class:"full-width row flex-center text-grey-6 q-pa-lg"},de={class:"text-h6 text-weight-bold"},ue={class:"row justify-end q-mt-xl"},ce={__name:"UserPage",setup(me){const k=f([]),w=f([]),x=f(!1),g=f(!1),m=f(!1),t=f({id:null,name:"",email:"",phone:"",group_numbers:[],password:"",active:!0}),I=[{name:"id",label:"#",field:"id",sortable:!0,align:"left",style:"width: 50px"},{name:"name",label:"الاسم",field:"name",sortable:!0,align:"left"},{name:"phone",label:"رقم الهاتف",field:"phone",sortable:!0,align:"left"},{name:"group_numbers",label:"أرقام المجموعات",field:"group_numbers",align:"left"},{name:"active",label:"الحالة",field:"active",sortable:!0,align:"center",style:"width: 150px"},{name:"actions",label:"الإجراءات",field:"actions",align:"center",style:"width: 150px"}],_=async()=>{try{const r=await v.get("/api/groups");w.value=r.data}catch{console.error("Error fetching groups")}},h=async()=>{x.value=!0;try{const r=await v.get("/api/users");k.value=r.data}catch(r){console.error("Error fetching users:",r),i.fire({icon:"error",title:"فشل التحميل",text:"فشل تحميل المستخدمين"})}finally{x.value=!1}},D=()=>{m.value=!1,t.value={id:null,name:"",email:"",phone:"",group_numbers:[],password:"",active:!0},_(),g.value=!0},N=r=>{m.value=!0,t.value={...r,password:"",active:!!r.active},_(),g.value=!0},P=async()=>{try{const r={...t.value};m.value?(r.password||delete r.password,await v.put(`/api/users/${t.value.id}`,r),i.fire({icon:"success",title:"تم التعديل",text:"تم تعديل المستخدم بنجاح",timer:1500,showConfirmButton:!1})):(await v.post("/api/users",r),i.fire({icon:"success",title:"تم الإنشاء",text:"تم إنشاء المستخدم بنجاح",timer:1500,showConfirmButton:!1})),g.value=!1,h()}catch(r){if(console.error("Error saving user:",r),r.response&&r.response.status===422){const l=r.response.data.message||"يرجى التحقق من المدخلات";i.fire({icon:"error",title:"خطأ",text:l})}else i.fire({icon:"error",title:"خطأ",text:"حدث خطأ أثناء الحفظ"})}},$=r=>{i.fire({title:"تأكيد الحذف",text:`هل أنت متأكد من حذف المستخدم "${r.name}"؟`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"نعم، احذفه",cancelButtonText:"إلغاء"}).then(async l=>{if(l.isConfirmed)try{await v.delete(`/api/users/${r.id}`),i.fire("تم الحذف!","تم حذف المستخدم بنجاح.","success"),h()}catch(a){console.error("Error deleting user:",a),i.fire({icon:"error",title:"خطأ",text:"فشل الحذف"})}})},j=r=>{const l=w.value.find(a=>a.id===r);return l?l.name:r};return G(()=>{_(),h()}),(r,l)=>(d(),p(le,{class:"q-pa-md"},{default:o(()=>[s("div",re,[s("div",te,[e(u,{round:"",flat:"",color:"primary",icon:"arrow_forward",to:"/app"}),l[7]||(l[7]=s("div",null,[s("div",{class:"text-h4 text-primary text-weight-bold text-islamic"},"المستخدمين"),s("div",{class:"text-subtitle2 text-grey-7"},"إدارة مستخدمي التطبيق")],-1))]),e(u,{unelevated:"",rounded:"",color:"primary",icon:"add",label:"مستخدم جديد",onClick:D,class:"shadow-3 q-px-md"})]),e(B,{class:"glass-card q-pa-sm"},{default:o(()=>[e(X,{rows:k.value,columns:I,"row-key":"id",loading:x.value,flat:"",separator:"none",class:"bg-transparent text-grey-9 custom-table","table-header-class":"text-primary text-weight-bold bg-primary-1 rounded-borders"},{"body-cell-active":o(a=>[e(q,{props:a},{default:o(()=>[e(S,{rounded:"",color:a.row.active?"primary":"grey",class:"q-px-sm q-py-xs shadow-1"},{default:o(()=>[c(y(a.row.active?"نشط":"غير نشط")+" ",1),e(n,{name:a.row.active?"check_circle":"cancel",class:"q-ml-xs"},null,8,["name"])]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-group_numbers":o(a=>[e(q,{props:a},{default:o(()=>[s("div",se,[(d(!0),L(M,null,A(a.row.group_numbers,(Q,F)=>(d(),p(S,{key:F,rounded:"",color:"primary",class:"q-px-sm q-py-xs"},{default:o(()=>[c(y(j(Q)),1)]),_:2},1024))),128))])]),_:2},1032,["props"])]),"body-cell-actions":o(a=>[e(q,{props:a,"auto-width":""},{default:o(()=>[s("div",ne,[e(u,{flat:"",round:"",color:"primary-7",icon:"edit",size:"sm",class:"bg-primary-1 action-btn",onClick:Q=>N(a.row)},{default:o(()=>[e(z,null,{default:o(()=>[...l[8]||(l[8]=[c("تعديل",-1)])]),_:1})]),_:1},8,["onClick"]),e(u,{flat:"",round:"",color:"red-7",icon:"delete",size:"sm",class:"bg-red-1 action-btn",onClick:Q=>$(a.row)},{default:o(()=>[e(z,null,{default:o(()=>[...l[9]||(l[9]=[c("حذف",-1)])]),_:1})]),_:1},8,["onClick"])])]),_:2},1032,["props"])]),"no-data":o(()=>[s("div",ie,[e(n,{name:"warning",size:"sm",class:"q-mr-sm"}),l[10]||(l[10]=c(" لا يوجد مستخدمين حالياً ",-1))])]),_:1},8,["rows","loading"])]),_:1}),e(K,{modelValue:g.value,"onUpdate:modelValue":l[6]||(l[6]=a=>g.value=a),"transition-show":"scale","transition-hide":"scale"},{default:o(()=>[e(B,{style:{"min-width":"450px","border-radius":"20px"},class:"shadow-24 overflow-hidden"},{default:o(()=>[e(U,{class:"bg-primary text-white row items-center q-py-md q-px-lg"},{default:o(()=>[e(O,{icon:"person",color:"primary-8","text-color":"white",size:"md",class:"q-mr-md"}),s("div",de,y(m.value?"تعديل المستخدم":"مستخدم جديد"),1),e(Z),V(e(u,{icon:"close",flat:"",round:"",dense:"",class:"text-white op-70 hover-op-100"},null,512),[[T]])]),_:1}),e(R,{color:"primary-10"}),e(U,{class:"q-pa-lg"},{default:o(()=>[e(ae,{onSubmit:P,class:"q-gutter-md"},{default:o(()=>[e(b,{filled:"",dense:"",modelValue:t.value.name,"onUpdate:modelValue":l[0]||(l[0]=a=>t.value.name=a),label:"الاسم",color:"primary","bg-color":"grey-1",class:"rounded-borders",rules:[a=>!!a||"يرجى إدخال الاسم"]},{prepend:o(()=>[e(n,{name:"person",color:"primary"})]),_:1},8,["modelValue","rules"]),e(b,{filled:"",dense:"",modelValue:t.value.email,"onUpdate:modelValue":l[1]||(l[1]=a=>t.value.email=a),label:"البريد الإلكتروني",color:"primary","bg-color":"grey-1",class:"rounded-borders"},{prepend:o(()=>[e(n,{name:"email",color:"primary"})]),_:1},8,["modelValue"]),e(b,{filled:"",dense:"",modelValue:t.value.phone,"onUpdate:modelValue":l[2]||(l[2]=a=>t.value.phone=a),label:"رقم الهاتف",color:"primary","bg-color":"grey-1",class:"rounded-borders"},{prepend:o(()=>[e(n,{name:"phone",color:"primary"})]),_:1},8,["modelValue"]),e(Y,{filled:"",dense:"",modelValue:t.value.group_numbers,"onUpdate:modelValue":l[3]||(l[3]=a=>t.value.group_numbers=a),label:"أرقام المجموعات",options:w.value,"option-value":"id","option-label":"name",multiple:"",counter:"","max-values":"10","emit-value":"","map-options":"","use-chips":"",color:"primary","bg-color":"grey-1",class:"rounded-borders"},{prepend:o(()=>[e(n,{name:"list_alt",color:"primary"})]),_:1},8,["modelValue","options"]),m.value?H("",!0):(d(),p(b,{key:0,filled:"",dense:"",modelValue:t.value.password,"onUpdate:modelValue":l[4]||(l[4]=a=>t.value.password=a),label:"كلمة المرور",type:"password",color:"primary","bg-color":"grey-1",class:"rounded-borders",rules:[a=>!!a||"يرجى إدخال كلمة المرور"]},{prepend:o(()=>[e(n,{name:"lock",color:"primary"})]),_:1},8,["modelValue","rules"])),V((d(),p(ee,{tag:"label",class:"bg-grey-1 rounded-borders q-pa-md border-primary-1"},{default:o(()=>[e(C,{avatar:""},{default:o(()=>[t.value.active?(d(),p(n,{key:0,name:"toggle_on",color:"primary",size:"md"})):(d(),p(n,{key:1,name:"toggle_off",color:"grey",size:"md"}))]),_:1}),e(C,null,{default:o(()=>[e(E,{class:"text-weight-bold text-grey-8"},{default:o(()=>[...l[11]||(l[11]=[c("حالة الحساب",-1)])]),_:1}),e(E,{caption:""},{default:o(()=>[c(y(t.value.active?"حساب نشط":"حساب معطل"),1)]),_:1})]),_:1}),e(C,{side:""},{default:o(()=>[e(J,{modelValue:t.value.active,"onUpdate:modelValue":l[5]||(l[5]=a=>t.value.active=a),color:"primary"},null,8,["modelValue"])]),_:1})]),_:1})),[[W]]),s("div",ue,[V(e(u,{label:"إلغاء",color:"grey-7",flat:"",class:"q-mr-sm"},null,512),[[T]]),e(u,{label:m.value?"حفظ التغييرات":"إنشاء المستخدم",type:"submit",color:"primary",icon:"save",unelevated:"",class:"q-px-lg shadow-2",style:{"border-radius":"10px"}},null,8,["label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},_e=oe(ce,[["__scopeId","data-v-4cc31f1e"]]);export{_e as default};
